<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SibiTube</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #111; color: #eee; }
    h1 { color: #0ff; }
    input, button { margin-top: 10px; }
    .video-card { border: 1px solid #444; margin-top: 20px; padding: 10px; position: relative; }
    .thumb { width: 160px; height: 90px; object-fit: cover; margin-bottom: 10px; }
    .delete-btn { position: absolute; top: 10px; right: 10px; background: #f33; color: #fff; border: none; padding: 5px 10px; cursor: pointer; }
  </style>
</head>
<body>
  <h1>SibiTube 🚀</h1>
  <input type="text" id="titleInput" placeholder="Enter video title"><br>
  <input type="file" id="videoInput" accept="video/*"><br>
  <button onclick="uploadVideo()">Upload Video</button>
  <div id="videosContainer"></div>  <!-- Firebase SDKs -->  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getStorage, ref, uploadBytes, getDownloadURL, deleteObject } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js";
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB0ebfqIb9r1rLIl9Be9tQ14tCbe7UHxlY",
      authDomain: "sibitube3790.firebaseapp.com",
      projectId: "sibitube3790",
      storageBucket: "sibitube3790.appspot.com",
      messagingSenderId: "161156034362",
      appId: "1:161156034362:web:382e906d744396db8a6a03",
      measurementId: "G-CZ9MWCQ6FG"
    };

    const app = initializeApp(firebaseConfig);
    const storage = getStorage(app);
    const db = getFirestore(app);

    async function uploadVideo() {
      const file = document.getElementById("videoInput").files[0];
      const title = document.getElementById("titleInput").value.trim();
      if (!file || !title) return alert("Add a title and select a video");

      const fileName = `${Date.now()}-${file.name}`;
      const storageRef = ref(storage, `videos/${fileName}`);
      await uploadBytes(storageRef, file);
      const url = await getDownloadURL(storageRef);

      await addDoc(collection(db, "videos"), { title, url, fileName, uploaded: new Date() });
      alert("Uploaded ✅");
      location.reload();
    }

    async function deleteVideo(docId, fileName) {
      if (!confirm("Delete this video?")) return;
      await deleteDoc(doc(db, "videos", docId));
      await deleteObject(ref(storage, `videos/${fileName}`));
      alert("Deleted ❌");
      location.reload();
    }

    async function loadVideos() {
      const querySnapshot = await getDocs(collection(db, "videos"));
      const container = document.getElementById("videosContainer");
      querySnapshot.forEach((docSnap) => {
        const data = docSnap.data();
        const id = docSnap.id;
        const div = document.createElement("div");
        div.className = "video-card";

        const thumb = `<video class='thumb' src="${data.url}#t=2"></video>`;
        const video = `<video controls width="320" src="${data.url}"></video>`;
        const delBtn = `<button class='delete-btn' onclick="deleteVideo('${id}', '${data.fileName}')">Delete</button>`;

        div.innerHTML = `${delBtn}<h3>${data.title}</h3>${thumb}<br>${video}`;
        container.appendChild(div);
      });
    }

    loadVideos();
  </script></body>
</html>
